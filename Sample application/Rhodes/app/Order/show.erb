<% is_old_order = !@order['submissionDate'].nil? %>
<div data-role="page">
  <div data-role="header">
    <h3><%=h is_old_order ? Localization::Views[:old_order] : Localization::Views[:current_order] %></h3>
  </div>
  <div data-role="content">
    <%=h Localization::Views[:order_has_n_pictures] % @order['pictureIds'].length %>

    <div align="center" class="picture-gallery">
      <table>
      <%
        screenWidth = System.get_property('screen_orientation') == 'portrait' ? System.get_property('screen_width') : System.get_property('screen_height')
      %>

      <%
        cellIndex = 0

        # Approximate number of pictures per row by the usual size of 90px, then let CSS layout do the rest.
        # If less than a full row of thumbnails is shown, the image would be stretched to full width, therefore
        # I added max-width.
        picturesPerRow = (screenWidth - 31) / 95
        maxWidth = (screenWidth - 31) / picturesPerRow - 5

        for pictureId in @order['pictureIds']
          stateName = is_old_order ? 'printed' : 'uploaded'
      %>
        <% if cellIndex % picturesPerRow == 0 %><tr><% end %>
        <td>
          <img src="<%=h get_thumbnail_filename(pictureId, true) %>" style="max-width: <%=h maxWidth %>px" class="thumb">
          <br/>
          <img src="/public/images/<%=h stateName %>.png">
          <span><%=h Localization::Views[stateName.to_sym] %></span>
        </td>
        <% if cellIndex % picturesPerRow == picturesPerRow - 1 %></tr><% end %>
      <%
          cellIndex += 1
        end
      %>
      </table>
    </div>
  </div>
</div>

